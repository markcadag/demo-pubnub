<!-- Video Output Zone -->
<div id="video-out"> Making a Call </div>

<script>(function(){
    // This object will take in an array of XirSys STUN / TURN servers
    var customConfig = [];
  
    $.ajax({
        type: "POST",
        dataType: "json",
        url: "https://api.xirsys.com/getIceServers",
        data: {
            ident: "< Your username (not your email) >",
            secret: "< Your secret API token >",
            domain: "< www.yourdomain.com >",
            application: "default",
            room: "default",
            secure: 1
        },
        success: function (data, status) {
            // data.d is where the iceServers object lives
            customConfig = data.d.iceServers;
            console.log(customConfig);
        },
        async: false
    });
  
    // ~Warning~ You must get your own API Keys for non-demo purposes.
    // ~Warning~ Get your PubNub API Keys: http://www.pubnub.com/get-started/
    // The phone *number* can by any string value
    var phone = PHONE({
        number        : '1234',
        publish_key   : '< Your PubNub publish key >',
        subscribe_key : '< Your PubNub subscribe key >',
        ssl           : true,
        servers       : customConfig
    });

    // As soon as the phone is ready we can make calls
    phone.ready(function(){

        // Dial a Number and get the Call Session
        // For simplicity the phone number is the same for both caller/receiver.
        // you should use different phone numbers for each user.
        var session = phone.dial('1234');

    });

    // When Call Comes In or is to be Connected
    phone.receive(function(session){

        // Display Your Friend's Live Video
        session.connected(function(session){
            PUBNUB.$('video-out').appendChild(session.video);
        });

    });

})();</script>